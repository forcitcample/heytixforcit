/*
 * jQuery Scanner Detection
 *
 * Copyright (c) 2013 Julien Maurel
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 * https://github.com/julien-maurel/jQuery-Scanner-Detection
 *
 * Version: 1.1.4
 *
 */(function(e){e.fn.scannerDetection=function(t){if(typeof t=="string"){this.each(function(){this.scannerDetectionTest(t)});return this}var n={onComplete:!1,onError:!1,onReceive:!1,timeBeforeScanTest:100,avgTimeByChar:30,minLength:6,endChar:[9,13],stopPropagation:!1,preventDefault:!1};typeof t=="function"&&(t={onComplete:t});typeof t!="object"?t=e.extend({},n):t=e.extend({},n,t);this.each(function(){var n=this,r=e(n),i=0,s=0,o="",u=!1,a=!1,f=function(){i=0;o=""};n.scannerDetectionTest=function(e){if(e){i=s=0;o=e}if(o.length>=t.minLength&&s-i<o.length*t.avgTimeByChar){t.onComplete&&t.onComplete.call(n,o);r.trigger("scannerDetectionComplete",{string:o});f();return!0}t.onError&&t.onError.call(n,o);r.trigger("scannerDetectionError",{string:o});f();return!1};r.data("scannerDetection",{options:t}).unbind(".scannerDetection").bind("keydown.scannerDetection",function(e){if(i&&t.endChar.indexOf(e.which)!==-1){var n=jQuery.Event("keypress",e);n.type="keypress.scannerDetection";r.triggerHandler(n);e.preventDefault();e.stopImmediatePropagation()}}).bind("keypress.scannerDetection",function(e){t.stopPropagation&&e.stopImmediatePropagation();t.preventDefault&&e.preventDefault();if(i&&t.endChar.indexOf(e.which)!==-1){e.preventDefault();e.stopImmediatePropagation();u=!0}else{o+=String.fromCharCode(e.which);u=!1}i||(i=Date.now());s=Date.now();a&&clearTimeout(a);if(u){n.scannerDetectionTest();a=!1}else a=setTimeout(n.scannerDetectionTest,t.timeBeforeScanTest);t.onReceive&&t.onReceive.call(n,e);r.trigger("scannerDetectionReceive",{evt:e})})});return this}})(jQuery);